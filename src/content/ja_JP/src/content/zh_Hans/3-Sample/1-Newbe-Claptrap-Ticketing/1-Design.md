---
title: 'デザイン。'
metaTitle: '列車のチケットシステム - 設計。'
metaDescription: '列車のチケットシステム - 設計。'
---

> [現在表示されているバージョンは、機械が簡体字中国語から翻訳され、手動校正の結果です。ドキュメントに不適切な翻訳がある場合は、こちらをクリックして翻訳提案を提出してください。](https://crwd.in/newbeclaptrap)

## ビジネス分析。

### ビジネス境界。

システムには、チケットの残チケット管理セクションのみが含まれます。つまり、残りの座席を照会し、チケットを購入して座席を減らします。

注文情報、支払い、フロー制御、要求風制御などを生成する場合、この議論の範囲外です。

### ビジネスユースケース。

- 残りのチケットを照会し、2つの駅の間で利用可能な車両数と残りの座席数を照会することができます。
- 乗車券の乗車数を照会し、特定の乗車数を照会することができ、各駅間に残っている座席数。
- 座席指定注文をサポートし、顧客は特定の座席と座席を選択し、チケットを購入するために注文することができます。

## 困難な分析を実装します。

### 残りのチケット管理。

列車のチケット残高管理の難しさは、実際には、残りのチケット在庫の特殊性にあります。

SKU を最小単位とする通常の E コマース商品は、各 SKU 間で独立しており、互いに影響を与えません。

列車のチケットの残りの部分は、チケットが販売されたチケットの終点によって影響を受けるため、異なります。単純な論理モデルと組み合わせることで、この特殊性を詳しく説明します。

ここで、a、b、c、d の 4 つのサイトを通過する 1 つの車両が存在すると仮定し、同時に、1 つの座席しか想定してシナリオを簡略化します。

チケットを購入する人がいないまで、このチケットの残りの部分は次のようになります：

| 終了点を設定します。 | 残りのチケット。 |
| ---------- | -------- |
| a,b.       | 1。       |
| a,c.       | 1。       |
| 、d。        | 1。       |
| b,c.       | 1。       |
| b,d.       | 1。       |
| c,d.       | 1。       |

今、顧客が a,c のチケットを購入した場合。座席が1つしかないため、a、b、b、cの残りのチケットはありません。残りの投票状況は次のようになります：

| 終了点を設定します。 | 残りのチケット。 |
| ---------- | -------- |
| a,b.       | 0。       |
| a,c.       | 0。       |
| 、d。        | 0。       |
| b,c.       | 0。       |
| b,d.       | 0。       |
| c,d.       | 1。       |

より明確に、顧客がフルチケットa、dを購入した場合、すべての残りのチケットはすべて0になります。なぜなら、この席はいつもこの乗客に座っているからです。

これは、列車のチケットの特殊性：同じ座席の同じ座席であり、各終了ポイントの残りのチケットの数は、販売されたチケットの始まりと終了の影響を受けます。

少し伸びると、同じ乗り台間にその影響はないと簡単に導き出すことができます。

### 残りのチケットのクエリ。

前のセクションで説明したように、残りのチケット在庫の特殊性のために。同じ列車 a、b、c、d の場合、チケット購入の選択肢は 6 つあります。

そして、選択したカテゴリの数は、実際には n サイトで 2 つの組み合わせ (c(n,2) を選択することによって計算されます。

34 のサイトを通過する車両がある場合、可能な組み合わせは c(34,2) = 561 です。

可能な複数のクエリに効率的に対処する方法も、システムが解決する必要がある問題です。

## Claptrap本体デザイン。

![Train Ticketing System Design.](/images/20200720-001.png)

### 同じ乗りで各座席をClaptrap -SeatGrainとして設計する。

Claptrap の State には、基本的な情報が含まれています。

| 型。                                | 名前。         | 説明                                                                                                  |
| --------------------------------- | ----------- | --------------------------------------------------------------------------------------------------- |
| IList&lt;int&gt;      | ステーションス。    | ルートステーションの ID のリストは、始発駅から始まり、終わりが終点です。主にチケットを購入するときに検証します。                                          |
| ディセリー&lt;int, int&gt; | StationDic. | ルート ステーション id のインデックス反転ディクショナリ。Stations は index-id のリストであり、辞書はクエリを高速化するために対応する id-index のディクショナリです。 |
| List&lt;string&gt;    | RequestIds  | キー プロパティ。各区間で、チケット購入ID。たとえば、index は 0 で、駅 0 からステーション 1 までのチケット ID を表します。空の場合は、サブスクリプションチケットはありません。  |

このデータ構造の設計により、2 つのビジネスを実装できます。

#### 購入できることを確認します。

2 つのステーション ID を渡すことで、この SeatGrain に属しているかどうかが問い合わせることができます。そして、始点と終点に対応するすべての区間に照会されます。RequestIds から、すべての区間がチケット ID を持たないかどうかを判断します。そうでない場合は、購入することができます。チケット購入 ID が既に存在する場合は、購入できません。

たとえば、現在のステーションの状況は 10,11,12,13 です。 RequestIds は 0,1,0 です。

RequestIds の 2 番目の区間が既に購入されているため、10->12 のチケットを購入する場合は、チケットは購入できません。

ただし、10->11 のチケットを購入する場合は、RequestIds の最初の区間はまだ誰も購入していないため、可能です。

#### 購入。

[終了] は、RequestIds のすべての区間設定でチケット ID を購入します。

### 同じ乗り分の残りの座席をClaptrap -TrainGranとして設計する。

Claptrap の State には、いくつかの基本的な情報が含まれています。

| 型。                                              | 名前。      | 説明                                                                                                                                |
| ----------------------------------------------- | -------- | --------------------------------------------------------------------------------------------------------------------------------- |
| IReadOnlyList&lt;int&gt;            | ステーションス。 | ルートステーションの ID のリストは、始発駅から始まり、終わりが終点です。マスター クエリは検証されます。                                                                            |
| イディセクションリー&lt;StationTuple, int&gt; | セトCount  | キー プロパティ。StationTuple は始まりと終わりを表します。コレクションには、すべての可能な開始点と終了の残りのチケットが含まれています。たとえば、上記のように、車両が 34 か所を通過した場合、辞書には 561 個のキーと値のペアが含まれます。 |

上記のデータ構造に基づいて、各SeatGrainが注文を完了した後、対応する情報をGrainに同期する必要があります。

たとえば、a,c がチケットを購入した場合、a、c/a、b/b、c の残りのチケットはすべて 1 つ減らされます。

ここでは、このフレームワークに組み込まれた Minion メカニズムを使用できます。

これは「最小競争資源」よりも大きなデザインであることを言及する価値があります。クエリ シナリオは、このビジネス シナリオで絶対に高速である必要がないためです。これにより、システムの複雑さが軽減されます。

## ID。

![Train Ticketing System Id.](/images/20200813-001.png)
