---
title: 'Дизайн.'
metaTitle: 'Система железнодорожных билетов - дизайн.'
metaDescription: 'Система железнодорожных билетов - дизайн.'
---

> [Рассматриваемая в настоящее время версия является результатом машинного перевода китайского упрощенного и ручного корректуры.Если в документе есть неправильный перевод, пожалуйста, нажмите здесь, чтобы представить свое предложение о переводе.](https://crwd.in/newbeclaptrap)

## Бизнес-анализ.

### Границы бизнеса.

Система содержит только оставшуюся часть билета по управлению билетом.То есть, запрос оставшихся мест, заказать билеты, чтобы уменьшить места.

Сбор информации о заказах, оплата, управление движением, контроль ветра запроса и т.д. не включены в сферу данного обсуждения.

### Случаи использования бизнеса.

- Проверьте оставшиеся билеты, чтобы узнать количество поездок между двумя станциями и количество мест, оставшихся.
- Запрос билета ставки, соответствующие количеству поездов, можно запросить данное количество поездов, между станциями есть, сколько оставшихся мест.
- Выбор мест поддерживается, и клиенты могут выбрать определенное количество автомобилей и мест и разместить заказ на покупку билета.

## Реализация сложного анализа yiter.

### Управление остаточном билетом.

Сложность управления излишним билетом на поезд заключается в специфике остальной части билетного инвентаря.

Обычные товары электронной коммерции, с SKUs как самая маленькая единица, каждый SKU не зависит друг от друга и не влияет друг на друга.

Билеты на поезд отличаются тем, что остальные билеты будут зависеть от начала и окончания проданных билетов.Вот простая логическая модель, чтобы подробно взглянуть на эту особенность.

Теперь предположим, что есть несколько автомобилей, проходящих через четыре станции, a, b, c, d, и в то же время мы упрощаем сценарий, предполагая, что есть только одно место в ряду.

Поэтому, прежде чем кто-то покупает билет, остальные билеты на эту поездку, как follows：

| С самого конца. | Количество оставшихся билетов. |
| --------------- | ------------------------------ |
| a,b.            | 1。                             |
| а, c.           | 1。                             |
| а, д.           | 1。                             |
| b,c.            | 1。                             |
| b,d.            | 1。                             |
| c, д.           | 1。                             |

Если клиент приобрел билет,c.Так как есть только одно место, a, b и b, c не имеют оставшихся билетов.Остальные голоса становятся следующими：

| С самого конца. | Количество оставшихся билетов. |
| --------------- | ------------------------------ |
| a,b.            | 0。                             |
| а, c.           | 0。                             |
| а, д.           | 1。                             |
| b,c.            | 0。                             |
| b,d.            | 1。                             |
| c, д.           | 1。                             |

Говоря более прямо, если клиент покупает, d, все оставшиеся билеты станут 0.Потому что пассажир всегда сидел на сиденье.

Это особый характер билета на поезд：том же месте одного и того же поезда, количество оставшихся билетов в каждой конечной точке будет зависеть от отправной точки проданного билета.

Немного расширяясь, легко сделать вывод, что нет такого эффекта между разными сиденьями в одном и том же автомобиле.

### Оставшиеся запросы на билеты.

Как уже упоминалось в предыдущем разделе, в связи с особенностью оставшегося инвентаря билетов.Для того же поезда a, b, c, d, есть 6 возможных вариантов билета.

И легко сделать вывод, что количество выбранных типов на самом деле рассчитывается путем выбора комбинации 2 в n сайтах, которая c (n, 2).

Так что если есть автомобиль, проходящий через 34 станций, возможно сочетание с (34,2) с 561.

Как бороться со многими видами запросов, которые могут существовать эффективно также является проблемой, которую система должна решить.

## Дизайн кузова Claptrap.

![Дизайн системы железнодорожных билетов.](/images/20200720-001.png)

### Каждое место в одном поезде спроектировано как Claptrap- SeatGrain.

Состояние Claptrap содержит основную информацию.

| Тип.                                | Имя.        | Описание                                                                                                                                                                                         |
| ----------------------------------- | ----------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| IList&lt;int&gt;        | Станций.    | Список идентификаторов для станции пути начинается со станции происхождения и заканчивается терминалом.Проверка на момент крупной покупки.                                                       |
| словарь&lt;int, int&gt; | StationDic. | Индекс обратного словаря идентификатора автовокзала.Станции представляют собой список индексных идентификаторов, а словарь — соответствующий словарь ID-индексов для ускорения запроса.          |
| Список&lt;string&gt;    | ЗапросИ.    | Ключевые свойства.На каждом интервале, билет id для покупки.Например, индекс 0, что означает идентификатор билета от станции 0 до станции 1.Если он пуст, в настоящее время подписка не имеется. |

С помощью такой структуры данных можно реализовать два предприятия.

#### Убедитесь, что он доступен для покупки.

Пройдя в двух идентификаторах станции, вы можете узнать, если это, как принадлежит к этому SeatGrain.И запросить все интервальные сегменты для стартовых и окончаний точек.Просто скажите, если это не имеет билет Id для всех сегментов, которые вы говорите от RequestIds.Если нет, это означает, что он может быть приобретен.Если у вас есть идентификатор на любой из абзацев, вы не можете.

Например, текущая ситуация на станциях 10, 11, 12, 13. RequestIds, с другой стороны, составляет 0,1,0.

Так что, если вы хотите купить билет на 10->12, а не потому, что второй диапазон RequestIds уже был приобретен.

Однако, если вы хотите купить билет на 10->11, вы можете, потому что первый диапазон RequestIds еще не доступен.

#### Купить.

Вы можете назначить "начало ingon" идентификатору билета в настройках интервала в RequestIds.

### Остальные билеты на все места в одном поезде разработаны как Claptrap-TrainGran.

Состояние Claptrap содержит некоторую основную информацию.

| Тип.                                  | Имя.       | Описание                                                                                                                                                                                                             |
| ------------------------------------- | ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| IReadOnlyList&lt;int&gt;  | Станций.   | Список идентификаторов для станции пути начинается со станции происхождения и заканчивается терминалом.Проверка сидеть на первичном запросе.                                                                         |
| &lt;StationTuple, int&gt; | SeatCount. | Ключевые свойства.Станция Tuple представляет собой отправную точку.Коллекция содержит все возможные билеты на старт и конец.Например, если автомобиль проходит через 34 локации, словарь содержит 561 ключевую пару. |

Основываясь на приведенной выше структуре данных, достаточно синхронизировать соответствующую информацию с зерном каждый раз, когда SeatGrain завершает размещение заказа.

Например, если a, c имеет покупку билета, оставшиеся билеты на a, c/a, b/b, c будут сокращены на один.

Это можно сделать здесь с помощью механизма Minion, встроенного в эту структуру.

Стоит отметить, что это более крупный дизайн, чем "наименее конкурентоспособные ресурсы".Поскольку сценарий запроса не требует абсолютной скорости в этом бизнес-сценарии.Такая конструкция снижает сложность системы.

## Id.

![Идентификатор системы железнодорожных билетов Id.](/images/20200813-001.png)
